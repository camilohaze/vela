name: Desarrollo de Historia de Usuario

on:
    workflow_dispatch:
        inputs:
            historia_key:
                description: "Clave de la Historia (ej: VELA-561)"
                required: true
                type: string
            sprint_id:
                description: "ID del Sprint"
                required: true
                type: number

jobs:
    desarrollar-historia:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout c√≥digo
              uses: actions/checkout@v3

            - name: Setup Python
              uses: actions/setup-python@v4
              with:
                  python-version: "3.x"

            - name: Instalar dependencias
              run: |
                  pip install requests

            - name: Ejecutar desarrollo
              env:
                  JIRA_URL: ${{ secrets.JIRA_URL || 'undefined' }}
                  JIRA_EMAIL: ${{ secrets.JIRA_EMAIL || 'undefined' }}
                  JIRA_API_TOKEN: ${{ secrets.JIRA_API_TOKEN || 'undefined' }}
                  HISTORIA_KEY: ${{ inputs.historia_key }}
                  SPRINT_ID: ${{ inputs.sprint_id }}
              run: |
                  python jira-import/develop_historia_v2.py

            - name: Commit cambios
              run: |
                  git config user.name "GitHub Actions"
                  git config user.email "actions@github.com"
                  git add docs/ src/ tests/
                  git commit -m "feat(${{ inputs.historia_key }}): desarrollar historia con entregables"
                  git push
